function [fx, dfx]=ElinBS(coefs,splines,parElin)

% Energy component for linear velocity
%


% How many splines?
N=length(splines);

% state vector length
C=length(coefs);

% initialize value and derivative with 0
fx=0;
dfx=zeros(C,1);

offsetjump=1;
nf=parElin(1);
speed=parElin(2);
frR=parElin(3);
k=parElin(4); % Charbonnier epsilon, if k==0, no scaling
hory=parElin(5);

splos=0; % splines segments offset
% global sceneInfo;
% frR=sceneInfo.frameRate;

sna=[splines(:).number]*2;
sna=cumsum(sna)-sna;

allcnt=0;
for id=1:N
    % % %     spl=splines(id);
    % % %     sder=fnder(spl.bspline,1);
    % % %     tr=spl.start:spl.end;
    % % %
    % % %     evder=spval(sder,tr);
    % % %     obj=sum((speed-frR*sqrt(sum(evder.^2))./nf).^2);
    % % % %     obj
    % % %     fx=fx+obj;
    % % %
    % % % %     obj=(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)^2;
    % % %
    % % % end
    
    spl=splines(id);
    %     sder=fnder(spl.bspline,1);
    
    % how many segments?
    %     pieces=spl.pieces;
    %     breaks=spl.breaks;
    % breaks=[1 10];
    
    tr=spl.start:spl.end;
    index = spl.index;
    knots = spl.knots;
    sn=spl.number;
    os=sna(id);
    %     locc=tr-breaks(index);
    
    lcnt=0;
    
    
    for t=1:length(tr)
        lcnt=lcnt+1;
        ilcnt=index(lcnt);
        bslcnt=ilcnt+3;
        
        %         tr(lcnt)
        %         knots
        %         knots(bslcnt-1:bslcnt+2);
        curt=tr(lcnt);
        %         curt=t;
        tx=knots(bslcnt-2:bslcnt+3);%-tr(lcnt);
        %                 [bslcnt-2 bslcnt+3]
        %         tx
        
        %         clocx=spl.bspline.coefs(1,ilcnt:ilcnt+3);
        %         clocy=spl.bspline.coefs(2,ilcnt:ilcnt+3);
        
        
        
        
        %         os = (ilcnt-1)*offsetjump + splos;
        
        
        svpos=[os+ilcnt:os+ilcnt+3 os+ilcnt+sn:os+ilcnt+3+sn];
        clocx=coefs(svpos(1:4))';
        clocy=coefs(svpos(5:8))';
        %         os
        %         clocx
        
        
        
        t1=tx(1);t2=tx(2);t3=tx(3);t4=tx(4); t5=tx(5);t6=tx(6);
        c1x=clocx(1);c2x=clocx(2);c3x=clocx(3);c4x=clocx(4);
        c1y=clocy(1);c2y=clocy(2);c3y=clocy(3);c4y=clocy(4);
        cmt1=curt-t1;cmt2=curt-t2;cmt3=curt-t3;cmt4=curt-t4;cmt5=curt-t5;cmt6=curt-t6;
        t14=t1-t4;        t24=t2-t4;        t25=t2-t5;        t34=t3-t4; t35=t3-t5;        t36=t3-t6;
        c2x_cmt1_c1x_cmt4=(c2x*cmt1 - c1x*cmt4);
        c2y_cmt1_c1y_cmt4=(c2y*cmt1 - c1y*cmt4);
        
        %         disp([curt tx])
        %         disp([clocx clocy])
        
        
        
        
        %         obj=(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)^2;
        %         fx=fx+obj;
        %         dfx(1 + os) = dfx(1 + os) + (2*frR*t3^2*(speed - (frR*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2))/nf)*((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4)))/(nf*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2)*(t1 - t3)*(t2 - t3)^2);
        %         dfx(2 + os) = dfx(2 + os) + -(2*frR*(speed - (frR*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2))/nf)*((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))*((t1*t3)/(t1 - t3) + (t2*t4)/(t2 - t4)))/(nf*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2)*(t2 - t3)^2);
        %         dfx(3 + os) = dfx(3 + os) + (2*frR*t2^2*(speed - (frR*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2))/nf)*((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4)))/(nf*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2)*(t2 - t3)^2*(t2 - t4));
        %         dfx(4 + os) = dfx(4 + os) + 0;
        %         dfx(5 + os) = dfx(5 + os) + (2*frR*t3^2*(speed - (frR*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2))/nf)*((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4)))/(nf*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2)*(t1 - t3)*(t2 - t3)^2);
        %         dfx(6 + os) = dfx(6 + os) + -(2*frR*(speed - (frR*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2))/nf)*((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))*((t1*t3)/(t1 - t3) + (t2*t4)/(t2 - t4)))/(nf*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2)*(t2 - t3)^2);
        %         dfx(7 + os) = dfx(7 + os) + (2*frR*t2^2*(speed - (frR*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2))/nf)*((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4)))/(nf*(((t3*(c2x*t1 - c1x*t3))/(t1 - t3) - (t2*(c3x*t2 - c2x*t4))/(t2 - t4))^2/(t2 - t3)^2 + ((t3*(c2y*t1 - c1y*t3))/(t1 - t3) - (t2*(c3y*t2 - c2y*t4))/(t2 - t4))^2/(t2 - t3)^2)^(1/2)*(t2 - t3)^2*(t2 - t4));
        %         dfx(8 + os) = dfx(8 + os) + 0;
        
        %         dfx(1 + os) = dfx(1 + os) + -(6*frR*tsq*(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)*px_)/(nf*(px_^2 + py_^2)^(1/2));
        %         dfx(2 + os) = dfx(2 + os) + -(4*frR*t*(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)*px_)/(nf*(px_^2 + py_^2)^(1/2));
        %         dfx(3 + os) = dfx(3 + os) + -(frR*(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)*(2*cx + 4*bx*t + 6*ax*tsq))/(nf*(px_^2 + py_^2)^(1/2));
        %         dfx(4 + os) = dfx(4 + os) + 0;
        %         dfx(5 + os) = dfx(5 + os) + -(6*frR*tsq*(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)*py_)/(nf*(px_^2 + py_^2)^(1/2));
        %         dfx(6 + os) = dfx(6 + os) + -(4*frR*t*(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)*py_)/(nf*(px_^2 + py_^2)^(1/2));
        %         dfx(7 + os) = dfx(7 + os) + -(frR*(speed - (frR*(px_^2 + py_^2)^(1/2))/nf)*(2*cy + 4*by*t + 6*ay*tsq))/(nf*(px_^2 + py_^2)^(1/2));
        %         dfx(8 + os) = dfx(8 + os) + 0;
        
        if k>0 % ETH scaling
obj=(frR^2*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/t34^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/t34^2))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2));
fx=fx+obj;
dfx(svpos(1)) = dfx(svpos(1)) + -(6*frR^2*cmt4^2*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t14*t24*t34^2);
dfx(svpos(2)) = dfx(svpos(2)) + (2*frR^2*(((cmt1*cmt4)/t14 + (cmt2*cmt5)/t25)/t24 + (cmt4*(cmt1/t14 + cmt2/t25 + cmt4/t14 + cmt5/t25))/t24 + cmt5^2/(t25*t35) + (2*cmt3*cmt5)/(t25*t35))*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t34^2);
dfx(svpos(3)) = dfx(svpos(3)) + -(2*frR^2*(((cmt2*cmt5)/t25 + (cmt3*cmt6)/t36)/t35 + (cmt3*(cmt2/t25 + cmt3/t36 + cmt5/t25 + cmt6/t36))/t35 + cmt2^2/(t24*t25) + (2*cmt2*cmt4)/(t24*t25))*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t34^2);
dfx(svpos(4)) = dfx(svpos(4)) + (6*frR^2*cmt3^2*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t34^2*t35*t36);
dfx(svpos(5)) = dfx(svpos(5)) + (2*frR^2*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/t34^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/t34^2)*(hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)*cmt4^3)/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)^2*t14*t24*t34) - (6*frR^2*cmt4^2*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t14*t24*t34^2);
dfx(svpos(6)) = dfx(svpos(6)) + (2*frR^2*(((cmt1*cmt4)/t14 + (cmt2*cmt5)/t25)/t24 + (cmt4*(cmt1/t14 + cmt2/t25 + cmt4/t14 + cmt5/t25))/t24 + cmt5^2/(t25*t35) + (2*cmt3*cmt5)/(t25*t35))*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t34^2) - (2*frR^2*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/t34^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/t34^2)*(hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)*((((cmt1*cmt4)/t14 + (cmt2*cmt5)/t25)*cmt4)/t24 + (cmt3*cmt5^2)/(t25*t35)))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)^2*t34);
dfx(svpos(7)) = dfx(svpos(7)) + (2*frR^2*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/t34^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/t34^2)*(hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)*((((cmt2*cmt5)/t25 + (cmt3*cmt6)/t36)*cmt3)/t35 + (cmt2^2*cmt4)/(t24*t25)))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)^2*t34) - (2*frR^2*(((cmt2*cmt5)/t25 + (cmt3*cmt6)/t36)/t35 + (cmt3*(cmt2/t25 + cmt3/t36 + cmt5/t25 + cmt6/t36))/t35 + cmt2^2/(t24*t25) + (2*cmt2*cmt4)/(t24*t25))*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t34^2);
dfx(svpos(8)) = dfx(svpos(8)) + (6*frR^2*cmt3^2*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)*t34^2*t35*t36) - (2*frR^2*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/t34^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/t34^2)*(hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)*cmt3^3)/(nf^2*(k + (hory + ((((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)*cmt4)/t24 - ((((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)*cmt3)/t35)/t34)^2)^2*t34*t35*t36);
        else
            
            obj=(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)^2;
            fx=fx+obj;
            dfx(svpos(1)) = dfx(svpos(1)) + (6*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*cmt4^2*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*t14*t24*(t3 - t4)^2);
            dfx(svpos(2)) = dfx(svpos(2)) + -(2*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*(((cmt1*cmt4)/t14 + (cmt2*cmt5)/t25)/t24 + (cmt4*(cmt1/t14 + cmt2/t25 + cmt4/t14 + cmt5/t25))/t24 + cmt5^2/(t25*t35) + (2*cmt3*cmt5)/(t25*t35))*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*(t3 - t4)^2);
            dfx(svpos(3)) = dfx(svpos(3)) + (2*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*(((cmt2*cmt5)/t25 + (cmt3*cmt6)/t36)/t35 + (cmt3*(cmt2/t25 + cmt3/t36 + cmt5/t25 + cmt6/t36))/t35 + cmt2^2/(t24*t25) + (2*cmt2*cmt4)/(t24*t25))*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*(t3 - t4)^2);
            dfx(svpos(4)) = dfx(svpos(4)) + -(6*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*cmt3^2*(((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*(t3 - t4)^2*t35*t36);
            dfx(svpos(5)) = dfx(svpos(5)) + (6*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*cmt4^2*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*t14*t24*(t3 - t4)^2);
            dfx(svpos(6)) = dfx(svpos(6)) + -(2*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*(((cmt1*cmt4)/t14 + (cmt2*cmt5)/t25)/t24 + (cmt4*(cmt1/t14 + cmt2/t25 + cmt4/t14 + cmt5/t25))/t24 + cmt5^2/(t25*t35) + (2*cmt3*cmt5)/(t25*t35))*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*(t3 - t4)^2);
            dfx(svpos(7)) = dfx(svpos(7)) + (2*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*(((cmt2*cmt5)/t25 + (cmt3*cmt6)/t36)/t35 + (cmt3*(cmt2/t25 + cmt3/t36 + cmt5/t25 + cmt6/t36))/t35 + cmt2^2/(t24*t25) + (2*cmt2*cmt4)/(t24*t25))*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*(t3 - t4)^2);
            dfx(svpos(8)) = dfx(svpos(8)) + -(6*frR*(speed - (frR*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2))/nf)*cmt3^2*(((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35))/(nf*((((c2x_cmt1_c1x_cmt4*cmt4)/t14 - ((c3x*cmt2 - c2x*cmt5)*cmt2)/t25)/t24 - (((c3x*cmt2 - c2x*cmt5)*cmt5)/t25 - ((c4x*cmt3 - c3x*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2x_cmt1_c1x_cmt4/t14 - (c3x*cmt2 - c2x*cmt5)/t25 - ((c1x - c2x)*cmt4)/t14 + ((c2x - c3x)*cmt2)/t25))/t24 - (cmt3*((c3x*cmt2 - c2x*cmt5)/t25 - (c4x*cmt3 - c3x*cmt6)/t36 - ((c2x - c3x)*cmt5)/t25 + ((c3x - c4x)*cmt3)/t36))/t35)^2/(t3 - t4)^2 + (((c2y_cmt1_c1y_cmt4*cmt4)/t14 - ((c3y*cmt2 - c2y*cmt5)*cmt2)/t25)/t24 - (((c3y*cmt2 - c2y*cmt5)*cmt5)/t25 - ((c4y*cmt3 - c3y*cmt6)*cmt3)/t36)/t35 + (cmt4*(c2y_cmt1_c1y_cmt4/t14 - (c3y*cmt2 - c2y*cmt5)/t25 - ((c1y - c2y)*cmt4)/t14 + ((c2y - c3y)*cmt2)/t25))/t24 - (cmt3*((c3y*cmt2 - c2y*cmt5)/t25 - (c4y*cmt3 - c3y*cmt6)/t36 - ((c2y - c3y)*cmt5)/t25 + ((c3y - c4y)*cmt3)/t36))/t35)^2/(t3 - t4)^2)^(1/2)*(t3 - t4)^2*t35*t36);
            
        end
        
    end
    splos = splos + spl.number*2;
end

end